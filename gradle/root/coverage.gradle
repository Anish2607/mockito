apply plugin: 'jacoco'
apply from: 'gradle/dependencies.gradle'

jacoco {
    toolVersion = libraries.jacocoVersion
}

task mockitoCoverage(type: JacocoReport, dependsOn: ["test", "kotlinTest:test", "extTest:test", "inline:test"]) {
    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    sourceSets sourceSets.main

    subprojects {
        sourceSets it.sourceSets.main
    }

    reports {
        xml.enabled true
        html.enabled true
        html.destination file("${buildDir}/jacocoHtml")
    }

    afterEvaluate {
      classDirectories = files(classDirectories.files.collect {
        fileTree(
          dir: it,
          exclude: ['**/org/mockito/internal/util/concurrent/**']
        )
      })
    }

    doLast {
        println "Jacoco report for client created: file://${reports.xml.destination.toURI().path}"
    }
}

task coverageReport(dependsOn: ["mockitoCoverage"]) {}
